# ML Service - –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö

FastAPI —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (CSV, JSON, XML) –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (PostgreSQL, ClickHouse, HDFS) —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π DDL-—Å–∫—Ä–∏–ø—Ç–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
ml_service/
‚îú‚îÄ‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ models/              # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Pydantic)
‚îú‚îÄ‚îÄ parsers/             # –ü–∞—Ä—Å–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤ (CSV, JSON, XML)
‚îú‚îÄ‚îÄ analyzers/           # –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îú‚îÄ‚îÄ generators/          # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã DDL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –°–£–ë–î
‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã (–∫—ç—à, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã)
‚îú‚îÄ‚îÄ uploads/             # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ .env.example         # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## ‚ú® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ü–∞—Ä—Å–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- **CSV-–ø–∞—Ä—Å–µ—Ä**: –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **JSON-–ø–∞—Ä—Å–µ—Ä**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –º–∞—Å—Å–∏–≤–æ–≤
- **XML-–ø–∞—Ä—Å–µ—Ä**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–ª–æ–∂–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏

### 2. –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- **Rule-based**: –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- **LLM-—É–ª—É—á—à–µ–Ω–∏—è**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DDL
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞**:
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ + –±–æ–ª—å—à–æ–π –æ–±—ä–µ–º ‚Üí ClickHouse
  - –°–ª–æ–∂–Ω—ã–µ —Å–≤—è–∑–∏ + –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ‚Üí PostgreSQL
  - –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã + –∞—Ä—Ö–∏–≤–∞—Ü–∏—è ‚Üí HDFS

### 3. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã DDL
- **PostgreSQL**: CREATE TABLE —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏, JSONB
- **ClickHouse**: ENGINE = MergeTree, –ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ
- **HDFS**: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ä–º–∞—Ç—É (Parquet)

### 4. API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `GET /` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ
- `POST /analyze` - –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
- `POST /recommend` - –ø–æ–ª–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —Ö—Ä–∞–Ω–∏–ª–∏—â—É
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `GET /cache/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
- `DELETE /cache/clear` - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Production)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.9+
- pip

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
git clone <repository-url>
cd Project
./scripts/setup.sh
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
nano ml_service/.env
```
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
- `OPENAI_API_KEY` - –≤–∞—à API –∫–ª—é—á OpenAI

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```bash
./scripts/start.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
curl http://localhost:8000/health
```

API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs

## üõ†Ô∏è –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
python3 -m venv venv
source venv/bin/activate
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
cd ml_service
pip install -r requirements.txt
```

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

4. **–ó–∞–ø—É—Å–∫:**
```bash
python run.py --host 0.0.0.0 --port 8000
```

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
```bash
curl -X POST "http://localhost:8000/analyze" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@data.csv" \
  -F "format=csv"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```bash
curl -X POST "http://localhost:8000/recommend" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@data.json" \
  -F "format=json" \
  -F "table_name=users"
```

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

```json
{
  "target": "clickhouse|postgresql|hdfs",
  "confidence": 0.0-1.0,
  "rationale": "—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ",
  "schedule_hint": "realtime|hourly|daily|weekly|monthly",
  "ddl_hints": ["hint1", "hint2"],
  "ddl_script": "CREATE TABLE ...",
  "data_profile": {
    "format": "csv|json|xml",
    "record_count": int,
    "field_count": int,
    "has_temporal": bool,
    "has_numeric": bool,
    "has_text": bool,
    "has_categorical": bool,
    "has_spatial": bool,
    "has_nested": bool,
    "unique_ids": ["field1", "field2"],
    "temporal_range": ["min_date", "max_date"],
    "estimated_size_mb": float
  }
}
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

- **–ó–∞–ø—É—Å–∫:** `./scripts/start.sh`
- **–û—Å—Ç–∞–Ω–æ–≤–∫–∞:** `./scripts/stop.sh`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:** `curl http://localhost:8000/health`
- **–õ–æ–≥–∏:** `tail -f logs/app.log`

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `ENABLE_LLM` - –≤–∫–ª—é—á–µ–Ω–∏–µ LLM —É–ª—É—á—à–µ–Ω–∏–π (default: true)
- `MAX_TOKENS` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (default: 2000)
- `CACHE_TTL` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (default: 7200)
- `UPLOAD_MAX_SIZE_MB` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (default: 10000)
- `DEBUG` - —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (default: false)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –¥–ª—è production-–æ–∫—Ä—É–∂–µ–Ω–∏—è

## üêõ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:
```bash
cd ml_service
python -m pytest tests/
```

–î–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
python test_load_testing.py
```